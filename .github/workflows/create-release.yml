name: Create release

on:
  workflow_call:
    inputs:
      zip_files:
        description: 'A list of extra zip files to include in the release archive'
        required: false
        type: string

jobs:
  create-release:
    name: 'Create Release ${{ github.ref_name }}'
    runs-on: ubuntu-24.04
    permissions:
      contents: write # Needed to create a release
    env:
      ZIP_NAME: '${{ github.event.repository.name }}-${{ github.ref_name }}.zip'
    steps:
      - name: 'ðŸ“¥ Check out repository code'
        uses: actions/checkout@v6

      - name: 'âš™ï¸ Download all workflow run artifacts'
        uses: actions/download-artifact@v7
        with:
          path: artifacts

      - name: 'ðŸ“‚ Print file tree'
        run: tree .

      - name: 'ðŸ“¦ Make a release archive'
        run: > # `shopt -s globstar` enables recursive globs
          shopt -s globstar &&
          zip -j ${{ env.ZIP_NAME }}
          artifacts/**/*.dll
          artifacts/**/*.so
          ${{ inputs.zip_files }}

      - name: 'ðŸ“‘ Create a release draft'
        uses: softprops/action-gh-release@v2
        with:
          body: '# ðŸ“‘ Changelog'
          append_body: true
          draft: true
          prerelease: true
          files: ${{ env.ZIP_NAME }}
          name: Release ${{ github.ref_name }}
          tag_name: ${{ github.ref_name }}
          fail_on_unmatched_files: true